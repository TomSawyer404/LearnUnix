# 文件系统

## 文件系统的抽象
### 从磁盘到块序列
- 一个硬盘由一些 *磁性盘片* 组成.
- 每个 *盘片* 被划分为很多**同心圆**. 这些**同心圆**被称作**磁道**.
- 每个**磁道**又进一步划分成多个**扇区**. 每个**扇区**可以存储一定bytes的数据, 大部分情况是每个**扇区**有512-Bytes.
- 就硬件系统而言, **扇区**是磁盘上基本的存储单元. 就软件(操作系统)而言, 操作文件的最小单位是**磁盘块**. 
- 一般情况下多个**扇区**组成一个**磁盘块**, 而且它们都有一个编号.
- 给**磁盘块**连续地编号, 使得我们可以视磁盘为一个线性数组.

### 从块序列到三区域划分
Unix系统将**磁盘块**分为3各部分:
![文件系统结构](https://images0.cnblogs.com/blog/472331/201304/28214052-600750f7ef834eab91c9548396142179.png)

- 超级块(superblock)
  这个块存放**文件系统**本身的结构信息.

- inode表(inode-table)
  1. 每个文件都有一些**属性**, 如大小, 文件所有者和最近修改信息.
  2. 这些**属性**被记录在`inode`的结构中, 所有`inode`都有相同的大小.
  3. `inode表`是这些结构的列表.
  4. 表中的每个`inode`都通过位置来标识, 例如标识为2的`inode`(inode 2) 位于文件系统`inode表`的第3个位置.

- 数据区(data-area)
  1. 文件的内容保存在此.
  2. 如果文件包含了超过一个块的内容, 则文件内容会存放在多个磁盘块中.

## pwd的工作原理
1. 得到`.`的`inode-number`, 称其为`n`(使用`stat`)
2. chdir..
3. 找到`inode-number`为`n`的链接的名字(使用`opendir`, `readdir`, `closedir`)
   重复, 直到达到树的顶端.

### 如何知道已经到达树的顶端？
在一个Unix文件系统的根目录, `.`和`..`指向同一个`inode`即为达到树的顶端.
程序员通常将下一个指针置为`NULL`, 用来标识一个链表结构的结束. Unix的设计者本可以将根目录的`..`置为空, 但还是决定将它指向本身.

### 如何以正确的顺序显示目录名字？
可以建立一个循环, 使用`strcat`或`sprintf`建立目录名字的字符串序列.
通过一个递归的程序逐步到达树的顶端来一个接一个地显示目录名, 从而避免了字符串管理.


---
